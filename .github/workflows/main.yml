name: cd
on:
  workflow_dispatch:
    inputs:
      customer:
        required: true
jobs:
  Add-Tenant:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    - name: Create tenant dirs
      run: cp -r kustomize/overlays/dev kustomize/overlays/${{ github.event.inputs.customer }}
    - name: Add tenant dirs to ArgoCD
      uses: mikefarah/yq@master
      with:
        cmd:
          yq -ie '.namespace = "${{ github.event.inputs.customer }}"' kustomize/overlays/${{ github.event.inputs.customer }}/kustomization.yml && cat kustomize/overlays/${{ github.event.inputs.customer }}/kustomization.yml
    # yq -ie  ".spec.generators[0].list.elements += [{\"env\": \"$TENANT\"}]" argocd/applicationset.yml
    # - name: Git Auto Commit
    #   uses: stefanzweifel/git-auto-commit-action@v5.0.0
